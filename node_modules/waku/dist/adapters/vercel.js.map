{"version":3,"sources":["../../src/adapters/vercel.ts"],"sourcesContent":["import { getRequestListener } from '@hono/node-server';\nimport { Hono } from 'hono';\nimport type { MiddlewareHandler } from 'hono';\nimport {\n  unstable_constants as constants,\n  unstable_createServerEntryAdapter as createServerEntryAdapter,\n  unstable_honoMiddleware as honoMiddleware,\n} from 'waku/internals';\nimport type { BuildOptions } from './vercel-build-enhancer.js';\n\nconst { DIST_PUBLIC } = constants;\nconst { contextMiddleware, rscMiddleware, middlewareRunner } = honoMiddleware;\n(global as any).__WAKU_HONO_NODE_SERVER_GET_REQUEST_LISTENER__ =\n  getRequestListener;\n\nexport default createServerEntryAdapter(\n  (\n    { processRequest, processBuild, config, notFoundHtml },\n    options?: {\n      static?: boolean;\n      assetsDir?: string;\n      middlewareFns?: (() => MiddlewareHandler)[];\n      middlewareModules?: Record<string, () => Promise<unknown>>;\n    },\n  ) => {\n    const { middlewareFns = [], middlewareModules = {} } = options || {};\n    const app = new Hono();\n    app.notFound((c) => {\n      if (notFoundHtml) {\n        return c.html(notFoundHtml, 404);\n      }\n      return c.text('404 Not Found', 404);\n    });\n    app.use(contextMiddleware());\n    for (const middlewareFn of middlewareFns) {\n      app.use(middlewareFn());\n    }\n    app.use(middlewareRunner(middlewareModules as never));\n    app.use(rscMiddleware({ processRequest }));\n    const buildOptions: BuildOptions = {\n      assetsDir: options?.assetsDir || 'assets',\n      distDir: config.distDir,\n      rscBase: config.rscBase,\n      privateDir: config.privateDir,\n      basePath: config.basePath,\n      DIST_PUBLIC,\n      serverless: !options?.static,\n    };\n    return {\n      fetch: app.fetch,\n      build: processBuild,\n      buildOptions,\n      buildEnhancers: ['waku/adapters/vercel-build-enhancer'],\n    };\n  },\n);\n"],"names":["getRequestListener","Hono","unstable_constants","constants","unstable_createServerEntryAdapter","createServerEntryAdapter","unstable_honoMiddleware","honoMiddleware","DIST_PUBLIC","contextMiddleware","rscMiddleware","middlewareRunner","global","__WAKU_HONO_NODE_SERVER_GET_REQUEST_LISTENER__","processRequest","processBuild","config","notFoundHtml","options","middlewareFns","middlewareModules","app","notFound","c","html","text","use","middlewareFn","buildOptions","assetsDir","distDir","rscBase","privateDir","basePath","serverless","static","fetch","build","buildEnhancers"],"mappings":"AAAA,SAASA,kBAAkB,QAAQ,oBAAoB;AACvD,SAASC,IAAI,QAAQ,OAAO;AAE5B,SACEC,sBAAsBC,SAAS,EAC/BC,qCAAqCC,wBAAwB,EAC7DC,2BAA2BC,cAAc,QACpC,iBAAiB;AAGxB,MAAM,EAAEC,WAAW,EAAE,GAAGL;AACxB,MAAM,EAAEM,iBAAiB,EAAEC,aAAa,EAAEC,gBAAgB,EAAE,GAAGJ;AAC9DK,OAAeC,8CAA8C,GAC5Db;AAEF,eAAeK,yBACb,CACE,EAAES,cAAc,EAAEC,YAAY,EAAEC,MAAM,EAAEC,YAAY,EAAE,EACtDC;IAOA,MAAM,EAAEC,gBAAgB,EAAE,EAAEC,oBAAoB,CAAC,CAAC,EAAE,GAAGF,WAAW,CAAC;IACnE,MAAMG,MAAM,IAAIpB;IAChBoB,IAAIC,QAAQ,CAAC,CAACC;QACZ,IAAIN,cAAc;YAChB,OAAOM,EAAEC,IAAI,CAACP,cAAc;QAC9B;QACA,OAAOM,EAAEE,IAAI,CAAC,iBAAiB;IACjC;IACAJ,IAAIK,GAAG,CAACjB;IACR,KAAK,MAAMkB,gBAAgBR,cAAe;QACxCE,IAAIK,GAAG,CAACC;IACV;IACAN,IAAIK,GAAG,CAACf,iBAAiBS;IACzBC,IAAIK,GAAG,CAAChB,cAAc;QAAEI;IAAe;IACvC,MAAMc,eAA6B;QACjCC,WAAWX,SAASW,aAAa;QACjCC,SAASd,OAAOc,OAAO;QACvBC,SAASf,OAAOe,OAAO;QACvBC,YAAYhB,OAAOgB,UAAU;QAC7BC,UAAUjB,OAAOiB,QAAQ;QACzBzB;QACA0B,YAAY,CAAChB,SAASiB;IACxB;IACA,OAAO;QACLC,OAAOf,IAAIe,KAAK;QAChBC,OAAOtB;QACPa;QACAU,gBAAgB;YAAC;SAAsC;IACzD;AACF,GACA"}