{"version":3,"sources":["../../src/adapters/aws-lambda-build-enhancer.ts"],"sourcesContent":["import { writeFileSync } from 'node:fs';\nimport path from 'node:path';\n\nexport type BuildOptions = { distDir: string };\n\nasync function postBuild({ distDir }: BuildOptions) {\n  const SERVE_JS = 'serve-aws-lambda.js';\n  const serveCode = `\nimport { INTERNAL_runFetch } from './server/index.js';\n\nconst handle = globalThis.__WAKU_AWS_LAMBDA_HANDLE__;\n\nexport const handler = handle({\n  fetch: (req, ...args) => INTERNAL_runFetch(process.env, req, ...args),\n});\n`;\n  writeFileSync(path.join(distDir, SERVE_JS), serveCode);\n  writeFileSync(\n    path.join(distDir, 'package.json'),\n    JSON.stringify({ type: 'module' }, null, 2),\n  );\n}\n\nexport default async function buildEnhancer(\n  build: (utils: unknown, options: BuildOptions) => Promise<void>,\n): Promise<typeof build> {\n  return async (utils: unknown, options: BuildOptions) => {\n    await build(utils, options);\n    await postBuild(options);\n  };\n}\n"],"names":["writeFileSync","path","postBuild","distDir","SERVE_JS","serveCode","join","JSON","stringify","type","buildEnhancer","build","utils","options"],"mappings":"AAAA,SAASA,aAAa,QAAQ,UAAU;AACxC,OAAOC,UAAU,YAAY;AAI7B,eAAeC,UAAU,EAAEC,OAAO,EAAgB;IAChD,MAAMC,WAAW;IACjB,MAAMC,YAAY,CAAC;;;;;;;;AAQrB,CAAC;IACCL,cAAcC,KAAKK,IAAI,CAACH,SAASC,WAAWC;IAC5CL,cACEC,KAAKK,IAAI,CAACH,SAAS,iBACnBI,KAAKC,SAAS,CAAC;QAAEC,MAAM;IAAS,GAAG,MAAM;AAE7C;AAEA,eAAe,eAAeC,cAC5BC,KAA+D;IAE/D,OAAO,OAAOC,OAAgBC;QAC5B,MAAMF,MAAMC,OAAOC;QACnB,MAAMX,UAAUW;IAClB;AACF"}