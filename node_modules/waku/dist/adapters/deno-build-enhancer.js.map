{"version":3,"sources":["../../src/adapters/deno-build-enhancer.ts"],"sourcesContent":["import { writeFileSync } from 'node:fs';\nimport path from 'node:path';\n\nexport type BuildOptions = { distDir: string };\n\nasync function postBuild({ distDir }: BuildOptions) {\n  const SERVE_JS = 'serve-deno.js';\n  const serveCode = `\nimport { Hono } from 'jsr:@hono/hono';\nimport { serveStatic } from 'jsr:@hono/hono/deno';\n\nglobalThis.__WAKU_DENO_ADAPTER_HONO__ = Hono;\nglobalThis.__WAKU_DENO_ADAPTER_SERVE_STATIC__ = serveStatic;\n\nconst { INTERNAL_runFetch } = await import('./server/index.js');\n\nconst env = Deno.env.toObject();\nDeno.serve((req, ...args) => INTERNAL_runFetch(env, req, ...args));\n`;\n  writeFileSync(path.join(distDir, SERVE_JS), serveCode);\n}\n\nexport default async function buildEnhancer(\n  build: (utils: unknown, options: BuildOptions) => Promise<void>,\n): Promise<typeof build> {\n  return async (utils: unknown, options: BuildOptions) => {\n    await build(utils, options);\n    await postBuild(options);\n  };\n}\n"],"names":["writeFileSync","path","postBuild","distDir","SERVE_JS","serveCode","join","buildEnhancer","build","utils","options"],"mappings":"AAAA,SAASA,aAAa,QAAQ,UAAU;AACxC,OAAOC,UAAU,YAAY;AAI7B,eAAeC,UAAU,EAAEC,OAAO,EAAgB;IAChD,MAAMC,WAAW;IACjB,MAAMC,YAAY,CAAC;;;;;;;;;;;AAWrB,CAAC;IACCL,cAAcC,KAAKK,IAAI,CAACH,SAASC,WAAWC;AAC9C;AAEA,eAAe,eAAeE,cAC5BC,KAA+D;IAE/D,OAAO,OAAOC,OAAgBC;QAC5B,MAAMF,MAAMC,OAAOC;QACnB,MAAMR,UAAUQ;IAClB;AACF"}