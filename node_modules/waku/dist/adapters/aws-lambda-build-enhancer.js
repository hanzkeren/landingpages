import { writeFileSync } from 'node:fs';
import path from 'node:path';
async function postBuild({ distDir }) {
    const SERVE_JS = 'serve-aws-lambda.js';
    const serveCode = `
import { INTERNAL_runFetch } from './server/index.js';

const handle = globalThis.__WAKU_AWS_LAMBDA_HANDLE__;

export const handler = handle({
  fetch: (req, ...args) => INTERNAL_runFetch(process.env, req, ...args),
});
`;
    writeFileSync(path.join(distDir, SERVE_JS), serveCode);
    writeFileSync(path.join(distDir, 'package.json'), JSON.stringify({
        type: 'module'
    }, null, 2));
}
export default async function buildEnhancer(build) {
    return async (utils, options)=>{
        await build(utils, options);
        await postBuild(options);
    };
}

//# sourceMappingURL=aws-lambda-build-enhancer.js.map