{"version":3,"sources":["../../src/adapters/netlify-build-enhancer.ts"],"sourcesContent":["import { existsSync, mkdirSync, writeFileSync } from 'node:fs';\nimport path from 'node:path';\n\nexport type BuildOptions = {\n  distDir: string;\n  privateDir: string;\n  DIST_PUBLIC: string;\n  serverless: boolean;\n};\n\nasync function postBuild({\n  distDir,\n  privateDir,\n  DIST_PUBLIC,\n  serverless,\n}: BuildOptions) {\n  if (serverless) {\n    const functionsDir = path.resolve('netlify-functions');\n    mkdirSync(functionsDir, {\n      recursive: true,\n    });\n    writeFileSync(\n      path.join(functionsDir, 'serve.js'),\n      `\\\nconst { INTERNAL_runFetch } = await import('../${distDir}/server/index.js');\n\nexport default async (request, context) =>\n  INTERNAL_runFetch(process.env, request, { context });\n\nexport const config = {\n  preferStatic: true,\n  path: ['/', '/*'],\n};\n`,\n    );\n  }\n  const netlifyTomlFile = path.resolve('netlify.toml');\n  if (!existsSync(netlifyTomlFile)) {\n    writeFileSync(\n      netlifyTomlFile,\n      `\\\n[build]\n  command = \"npm run build\"\n  publish = \"${distDir}/${DIST_PUBLIC}\"\n[functions]\n  included_files = [\"${privateDir}/**\"]\n  directory = \"netlify-functions\"\n`,\n    );\n  }\n}\n\nexport default async function buildEnhancer(\n  build: (utils: unknown, options: BuildOptions) => Promise<void>,\n): Promise<typeof build> {\n  return async (utils: unknown, options: BuildOptions) => {\n    await build(utils, options);\n    await postBuild(options);\n  };\n}\n"],"names":["existsSync","mkdirSync","writeFileSync","path","postBuild","distDir","privateDir","DIST_PUBLIC","serverless","functionsDir","resolve","recursive","join","netlifyTomlFile","buildEnhancer","build","utils","options"],"mappings":"AAAA,SAASA,UAAU,EAAEC,SAAS,EAAEC,aAAa,QAAQ,UAAU;AAC/D,OAAOC,UAAU,YAAY;AAS7B,eAAeC,UAAU,EACvBC,OAAO,EACPC,UAAU,EACVC,WAAW,EACXC,UAAU,EACG;IACb,IAAIA,YAAY;QACd,MAAMC,eAAeN,KAAKO,OAAO,CAAC;QAClCT,UAAUQ,cAAc;YACtBE,WAAW;QACb;QACAT,cACEC,KAAKS,IAAI,CAACH,cAAc,aACxB,CAAC;+CACwC,EAAEJ,QAAQ;;;;;;;;;AASzD,CAAC;IAEC;IACA,MAAMQ,kBAAkBV,KAAKO,OAAO,CAAC;IACrC,IAAI,CAACV,WAAWa,kBAAkB;QAChCX,cACEW,iBACA,CAAC;;;aAGM,EAAER,QAAQ,CAAC,EAAEE,YAAY;;qBAEjB,EAAED,WAAW;;AAElC,CAAC;IAEC;AACF;AAEA,eAAe,eAAeQ,cAC5BC,KAA+D;IAE/D,OAAO,OAAOC,OAAgBC;QAC5B,MAAMF,MAAMC,OAAOC;QACnB,MAAMb,UAAUa;IAClB;AACF"}