{"version":3,"sources":["../../src/adapters/node-build-enhancer.ts"],"sourcesContent":["import { writeFileSync } from 'node:fs';\nimport path from 'node:path';\n\nexport type BuildOptions = { distDir: string };\n\nasync function postBuild({ distDir }: BuildOptions) {\n  const SERVE_JS = 'serve-node.js';\n  const serveCode = `\nimport { INTERNAL_runFetch, unstable_serverEntry } from './server/index.js';\n\nconst { serve } = unstable_serverEntry;\n\nconst host = process.env.HOST;\nconst port = process.env.PORT;\n\nserve({\n  fetch: (req, ...args) => INTERNAL_runFetch(process.env, req, ...args),\n  ...(host ? { hostname: host } : {}),\n  ...(port ? { port: parseInt(port, 10) } : {}),\n});\n`;\n  writeFileSync(path.resolve(distDir, SERVE_JS), serveCode);\n}\n\nexport default async function buildEnhancer(\n  build: (utils: unknown, options: BuildOptions) => Promise<void>,\n): Promise<typeof build> {\n  return async (utils: unknown, options: BuildOptions) => {\n    await build(utils, options);\n    await postBuild(options);\n  };\n}\n"],"names":["writeFileSync","path","postBuild","distDir","SERVE_JS","serveCode","resolve","buildEnhancer","build","utils","options"],"mappings":"AAAA,SAASA,aAAa,QAAQ,UAAU;AACxC,OAAOC,UAAU,YAAY;AAI7B,eAAeC,UAAU,EAAEC,OAAO,EAAgB;IAChD,MAAMC,WAAW;IACjB,MAAMC,YAAY,CAAC;;;;;;;;;;;;;AAarB,CAAC;IACCL,cAAcC,KAAKK,OAAO,CAACH,SAASC,WAAWC;AACjD;AAEA,eAAe,eAAeE,cAC5BC,KAA+D;IAE/D,OAAO,OAAOC,OAAgBC;QAC5B,MAAMF,MAAMC,OAAOC;QACnB,MAAMR,UAAUQ;IAClB;AACF"}