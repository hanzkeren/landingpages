{"version":3,"sources":["../../src/minimal/client.tsx"],"sourcesContent":["'use client';\n\nimport {\n  createContext,\n  memo,\n  startTransition,\n  use,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react';\nimport type { ReactNode } from 'react';\nimport RSDWClient from 'react-server-dom-webpack/client';\nimport { createCustomError } from '../lib/utils/custom-errors.js';\nimport { encodeFuncId, encodeRscPath } from '../lib/utils/rsc-path.js';\n\nconst { createFromFetch, encodeReply, createTemporaryReferenceSet } =\n  RSDWClient;\n\nconst DEFAULT_HTML_HEAD = [\n  <meta charSet=\"utf-8\" key=\"charset\" />,\n  <meta\n    name=\"viewport\"\n    content=\"width=device-width, initial-scale=1\"\n    key=\"viewport\"\n  />,\n  <meta name=\"generator\" content=\"Waku\" key=\"generator\" />,\n];\n\nconst BASE_RSC_PATH = `${import.meta.env?.WAKU_CONFIG_BASE_PATH}${\n  import.meta.env?.WAKU_CONFIG_RSC_BASE\n}/`;\n\nconst checkStatus = async (\n  responsePromise: Promise<Response>,\n): Promise<Response> => {\n  const response = await responsePromise;\n  if (!response.ok) {\n    const location = response.headers.get('location');\n    const err = createCustomError(\n      (await response.text()) || response.statusText,\n      {\n        status: response.status,\n        ...(location && { location }),\n      },\n    );\n    throw err;\n  }\n  return response;\n};\n\ntype Elements = Record<string, unknown>;\n\n// TODO(daishi) do we still this?\nconst getCached = <T,>(c: () => T, m: WeakMap<object, T>, k: object): T =>\n  (m.has(k) ? m : m.set(k, c())).get(k) as T;\n\nconst cache1 = new WeakMap();\nconst mergeElementsPromise = (\n  a: Promise<Elements>,\n  b: Promise<Elements> | Elements,\n): Promise<Elements> => {\n  const getResult = () =>\n    Promise.all([a, b]).then(([a, b]) => {\n      const nextElements = { ...a, ...b };\n      delete nextElements._value;\n      return nextElements;\n    });\n  const cache2 = getCached(() => new WeakMap(), cache1, a);\n  return getCached(getResult, cache2, b);\n};\n\ntype SetElements = (\n  updater: (prev: Promise<Elements>) => Promise<Elements>,\n) => void;\n\nconst ENTRY = 'e';\nconst SET_ELEMENTS = 's';\nconst FETCH_RSC_INTERNAL = 'f';\n\ntype FetchRscInternal = {\n  (\n    rscPath: string,\n    rscParams: unknown,\n    prefetchOnly?: undefined | false,\n    fetchFn?: typeof fetch,\n  ): Promise<Elements>;\n  (\n    rscPath: string,\n    rscParams: unknown,\n    prefetchOnly: true,\n    fetchFn?: typeof fetch,\n  ): void;\n};\n\ntype FetchCache = {\n  [ENTRY]?: [\n    rscPath: string,\n    rscParams: unknown,\n    elementsPromise: Promise<Elements>,\n  ];\n  [SET_ELEMENTS]?: SetElements;\n  [FETCH_RSC_INTERNAL]?: FetchRscInternal;\n};\n\nconst defaultFetchCache: FetchCache = {};\n\n// TODO: This does't feel like an ideal solution.\ntype PrefetchedEntry =\n  | Promise<Response> // from html\n  | [\n      responsePromise: Promise<Response>,\n      rscParams?: unknown,\n      temporaryReferences?: ReturnType<typeof createTemporaryReferenceSet>,\n    ]; // from prefetch\n\nconst createFetchRscInternal =\n  (fetchCache: FetchCache): FetchRscInternal =>\n  (\n    rscPath: string,\n    rscParams: unknown,\n    prefetchOnly?: boolean,\n    fetchFn = fetch,\n  ) => {\n    const prefetched: Record<string, PrefetchedEntry> = ((\n      globalThis as any\n    ).__WAKU_PREFETCHED__ ||= {});\n    let prefetchedEntry = prefetchOnly ? undefined : prefetched[rscPath];\n    delete prefetched[rscPath];\n    if (prefetchedEntry) {\n      if (Array.isArray(prefetchedEntry)) {\n        if (prefetchedEntry[1] !== rscParams) {\n          prefetchedEntry = undefined;\n        }\n      } else {\n        // We don't check rscParams for the initial hydration\n        // It's limited and may result in a wrong result. FIXME\n        prefetchedEntry = [prefetchedEntry];\n      }\n    }\n    const temporaryReferences =\n      prefetchedEntry?.[2] || createTemporaryReferenceSet();\n    const url = BASE_RSC_PATH + encodeRscPath(rscPath);\n    const responsePromise = prefetchedEntry\n      ? prefetchedEntry[0]\n      : rscParams === undefined\n        ? fetchFn(url)\n        : rscParams instanceof URLSearchParams\n          ? fetchFn(url + '?' + rscParams)\n          : encodeReply(rscParams, { temporaryReferences }).then((body) =>\n              fetchFn(url, { method: 'POST', body }),\n            );\n    if (prefetchOnly) {\n      prefetched[rscPath] = [responsePromise, rscParams, temporaryReferences];\n      return undefined as never;\n    }\n    return createFromFetch<Elements>(checkStatus(responsePromise), {\n      callServer: (funcId: string, args: unknown[]) =>\n        unstable_callServerRsc(funcId, args, fetchCache),\n      temporaryReferences,\n    });\n  };\n\n/**\n * callServer callback\n * This is not a public API.\n */\nexport const unstable_callServerRsc = async (\n  funcId: string,\n  args: unknown[],\n  fetchCache = defaultFetchCache,\n) => {\n  const setElements = fetchCache[SET_ELEMENTS]!;\n  const fetchRscInternal = fetchCache[FETCH_RSC_INTERNAL]!;\n  const rscPath = encodeFuncId(funcId);\n  const rscParams =\n    args.length === 1 && args[0] instanceof URLSearchParams ? args[0] : args;\n  const { _value: value, ...data } = await fetchRscInternal(rscPath, rscParams);\n  if (Object.keys(data).length) {\n    startTransition(() => {\n      setElements((prev) => mergeElementsPromise(prev, data));\n    });\n  }\n  return value;\n};\n\nexport const fetchRsc = (\n  rscPath: string,\n  rscParams?: unknown,\n  fetchCache = defaultFetchCache,\n): Promise<Elements> => {\n  if (import.meta.hot) {\n    const refetchRsc = () => {\n      delete fetchCache[ENTRY];\n      const data = fetchRsc(rscPath, rscParams, fetchCache);\n      fetchCache[SET_ELEMENTS]!(() => data);\n    };\n    globalThis.__WAKU_RSC_RELOAD_LISTENERS__ ||= [];\n    const index = globalThis.__WAKU_RSC_RELOAD_LISTENERS__.indexOf(\n      globalThis.__WAKU_REFETCH_RSC__!,\n    );\n    if (index !== -1) {\n      globalThis.__WAKU_RSC_RELOAD_LISTENERS__.splice(index, 1, refetchRsc);\n    } else {\n      globalThis.__WAKU_RSC_RELOAD_LISTENERS__.push(refetchRsc);\n    }\n    globalThis.__WAKU_REFETCH_RSC__ = refetchRsc;\n  }\n\n  const fetchRscInternal = fetchCache[FETCH_RSC_INTERNAL]!;\n  const entry = fetchCache[ENTRY];\n  if (entry && entry[0] === rscPath && entry[1] === rscParams) {\n    return entry[2];\n  }\n  const data = fetchRscInternal(rscPath, rscParams);\n  fetchCache[ENTRY] = [rscPath, rscParams, data];\n  return data;\n};\n\nexport const prefetchRsc = (\n  rscPath: string,\n  rscParams?: unknown,\n  fetchCache = defaultFetchCache,\n): void => {\n  const fetchRscInternal = fetchCache[FETCH_RSC_INTERNAL]!;\n  const prefetched: Record<string, PrefetchedEntry> = ((\n    globalThis as any\n  ).__WAKU_PREFETCHED__ ||= {});\n  const prefetchedEntry = prefetched[rscPath];\n  if (Array.isArray(prefetchedEntry) && prefetchedEntry[1] === rscParams) {\n    return; // already prefetched\n  }\n  fetchRscInternal(rscPath, rscParams, true);\n};\n\nconst RefetchContext = createContext<\n  (rscPath: string, rscParams?: unknown) => Promise<void>\n>(() => {\n  throw new Error('Missing Root component');\n});\nconst ElementsContext = createContext<Promise<Elements> | null>(null);\n\ntype EnhanceFetchRscInternal = (\n  fn: (fetchRscInternal: FetchRscInternal) => FetchRscInternal,\n) => () => void;\n\nconst EnhanceFetchRscInternalContext = createContext<EnhanceFetchRscInternal>(\n  () => {\n    throw new Error('Missing Root component');\n  },\n);\n\nexport const useEnhanceFetchRscInternal_UNSTABLE = () =>\n  use(EnhanceFetchRscInternalContext);\n\nexport const Root = ({\n  initialRscPath,\n  initialRscParams,\n  fetchCache = defaultFetchCache,\n  children,\n}: {\n  initialRscPath?: string;\n  initialRscParams?: unknown;\n  fetchCache?: FetchCache;\n  children: ReactNode;\n}) => {\n  fetchCache[FETCH_RSC_INTERNAL] ||= createFetchRscInternal(fetchCache);\n  const enhanceFetchRscInternal: EnhanceFetchRscInternal = useMemo(() => {\n    const enhancers = new Set<Parameters<EnhanceFetchRscInternal>[0]>();\n    const enhance = () => {\n      let fetchRscInternal = createFetchRscInternal(fetchCache);\n      for (const fn of enhancers) {\n        fetchRscInternal = fn(fetchRscInternal);\n      }\n      fetchCache[FETCH_RSC_INTERNAL] = fetchRscInternal;\n    };\n    return (fn) => {\n      enhancers.add(fn);\n      enhance();\n      return () => {\n        enhancers.delete(fn);\n        enhance();\n      };\n    };\n  }, [fetchCache]);\n  const [elements, setElements] = useState(() =>\n    fetchRsc(initialRscPath || '', initialRscParams, fetchCache),\n  );\n  useEffect(() => {\n    fetchCache[SET_ELEMENTS] = setElements;\n  }, [fetchCache]);\n  const refetch = useCallback(\n    async (rscPath: string, rscParams?: unknown) => {\n      // clear cache entry before fetching\n      delete fetchCache[ENTRY];\n      const data = fetchRsc(rscPath, rscParams, fetchCache);\n      const dataWithoutErrors = Promise.resolve(data).catch(() => ({}));\n      setElements((prev) => mergeElementsPromise(prev, dataWithoutErrors));\n      await data;\n    },\n    [fetchCache],\n  );\n  return (\n    <EnhanceFetchRscInternalContext value={enhanceFetchRscInternal}>\n      <RefetchContext value={refetch}>\n        <ElementsContext value={elements}>\n          {DEFAULT_HTML_HEAD}\n          {children}\n        </ElementsContext>\n      </RefetchContext>\n    </EnhanceFetchRscInternalContext>\n  );\n};\n\nexport const useRefetch = () => use(RefetchContext);\n\nconst ChildrenContext = createContext<ReactNode>(undefined);\nconst ChildrenContextProvider = memo(ChildrenContext);\n\nexport const Children = () => use(ChildrenContext);\n\nexport const useElementsPromise_UNSTABLE = () => {\n  const elementsPromise = use(ElementsContext);\n  if (!elementsPromise) {\n    throw new Error('Missing Root component');\n  }\n  return elementsPromise;\n};\n\n/**\n * Slot component\n * This is used under the Root component.\n * Slot id is the key of elements returned by the server.\n *\n * If the server returns this\n * ```\n *   { 'foo': <div>foo</div>, 'bar': <div>bar</div> }\n * ```\n * then you can use this component like this\n * ```\n *   <Root><Slot id=\"foo\" /><Slot id=\"bar\" /></Root>\n * ```\n */\nexport const Slot = ({\n  id,\n  children,\n}: {\n  id: string;\n  children?: ReactNode;\n}) => {\n  const elementsPromise = useElementsPromise_UNSTABLE();\n  const elements = use(elementsPromise);\n  if (id in elements && elements[id] === undefined) {\n    throw new Error('Element cannot be undefined, use null instead: ' + id);\n  }\n  const element = elements[id];\n  const isValidElement = element !== undefined;\n  if (!isValidElement) {\n    throw new Error('Invalid element: ' + id);\n  }\n  return (\n    <ChildrenContextProvider value={children}>\n      {element as ReactNode}\n    </ChildrenContextProvider>\n  );\n};\n\n/**\n * ServerRoot for SSR\n * This is not a public API.\n */\nexport const INTERNAL_ServerRoot = ({\n  elementsPromise,\n  children,\n}: {\n  elementsPromise: Promise<Elements>;\n  children: ReactNode;\n}) => (\n  <ElementsContext value={elementsPromise}>\n    {DEFAULT_HTML_HEAD}\n    {children}\n  </ElementsContext>\n);\n"],"names":["createContext","memo","startTransition","use","useCallback","useEffect","useMemo","useState","RSDWClient","createCustomError","encodeFuncId","encodeRscPath","createFromFetch","encodeReply","createTemporaryReferenceSet","DEFAULT_HTML_HEAD","meta","charSet","name","content","BASE_RSC_PATH","env","WAKU_CONFIG_BASE_PATH","WAKU_CONFIG_RSC_BASE","checkStatus","responsePromise","response","ok","location","headers","get","err","text","statusText","status","getCached","c","m","k","has","set","cache1","WeakMap","mergeElementsPromise","a","b","getResult","Promise","all","then","nextElements","_value","cache2","ENTRY","SET_ELEMENTS","FETCH_RSC_INTERNAL","defaultFetchCache","createFetchRscInternal","fetchCache","rscPath","rscParams","prefetchOnly","fetchFn","fetch","prefetched","globalThis","__WAKU_PREFETCHED__","prefetchedEntry","undefined","Array","isArray","temporaryReferences","url","URLSearchParams","body","method","callServer","funcId","args","unstable_callServerRsc","setElements","fetchRscInternal","length","value","data","Object","keys","prev","fetchRsc","hot","refetchRsc","__WAKU_RSC_RELOAD_LISTENERS__","index","indexOf","__WAKU_REFETCH_RSC__","splice","push","entry","prefetchRsc","RefetchContext","Error","ElementsContext","EnhanceFetchRscInternalContext","useEnhanceFetchRscInternal_UNSTABLE","Root","initialRscPath","initialRscParams","children","enhanceFetchRscInternal","enhancers","Set","enhance","fn","add","delete","elements","refetch","dataWithoutErrors","resolve","catch","useRefetch","ChildrenContext","ChildrenContextProvider","Children","useElementsPromise_UNSTABLE","elementsPromise","Slot","id","element","isValidElement","INTERNAL_ServerRoot"],"mappings":"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"}