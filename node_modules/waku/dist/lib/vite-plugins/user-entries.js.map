{"version":3,"sources":["../../../src/lib/vite-plugins/user-entries.ts"],"sourcesContent":["import type { Plugin } from 'vite';\nimport { SRC_CLIENT_ENTRY, SRC_SERVER_ENTRY } from '../constants.js';\nimport {\n  getManagedClientEntry,\n  getManagedServerEntry,\n} from '../utils/managed.js';\n\nexport function userEntriesPlugin({ srcDir }: { srcDir: string }): Plugin {\n  return {\n    name: 'waku:vite-plugins:user-entries',\n    // resolve user entries and fallbacks to \"managed mode\" if not found.\n    async resolveId(source, _importer, options) {\n      if (source === 'virtual:vite-rsc-waku/server-entry') {\n        return '\\0' + source;\n      }\n      if (source === 'virtual:vite-rsc-waku/server-entry-inner') {\n        const resolved = await this.resolve(\n          `/${srcDir}/${SRC_SERVER_ENTRY}`,\n          undefined,\n          options,\n        );\n        return resolved ? resolved : '\\0' + source;\n      }\n      if (source === 'virtual:vite-rsc-waku/client-entry') {\n        const resolved = await this.resolve(\n          `/${srcDir}/${SRC_CLIENT_ENTRY}`,\n          undefined,\n          options,\n        );\n        return resolved ? resolved : '\\0' + source;\n      }\n    },\n    load(id) {\n      if (id === '\\0virtual:vite-rsc-waku/server-entry') {\n        return `\\\nexport { default } from 'virtual:vite-rsc-waku/server-entry-inner';\nif (import.meta.hot) {\n  import.meta.hot.accept()\n}\n`;\n      }\n      if (id === '\\0virtual:vite-rsc-waku/server-entry-inner') {\n        return getManagedServerEntry(srcDir);\n      }\n      if (id === '\\0virtual:vite-rsc-waku/client-entry') {\n        return getManagedClientEntry();\n      }\n    },\n  };\n}\n"],"names":["SRC_CLIENT_ENTRY","SRC_SERVER_ENTRY","getManagedClientEntry","getManagedServerEntry","userEntriesPlugin","srcDir","name","resolveId","source","_importer","options","resolved","resolve","undefined","load","id"],"mappings":"AACA,SAASA,gBAAgB,EAAEC,gBAAgB,QAAQ,kBAAkB;AACrE,SACEC,qBAAqB,EACrBC,qBAAqB,QAChB,sBAAsB;AAE7B,OAAO,SAASC,kBAAkB,EAAEC,MAAM,EAAsB;IAC9D,OAAO;QACLC,MAAM;QACN,qEAAqE;QACrE,MAAMC,WAAUC,MAAM,EAAEC,SAAS,EAAEC,OAAO;YACxC,IAAIF,WAAW,sCAAsC;gBACnD,OAAO,OAAOA;YAChB;YACA,IAAIA,WAAW,4CAA4C;gBACzD,MAAMG,WAAW,MAAM,IAAI,CAACC,OAAO,CACjC,CAAC,CAAC,EAAEP,OAAO,CAAC,EAAEJ,kBAAkB,EAChCY,WACAH;gBAEF,OAAOC,WAAWA,WAAW,OAAOH;YACtC;YACA,IAAIA,WAAW,sCAAsC;gBACnD,MAAMG,WAAW,MAAM,IAAI,CAACC,OAAO,CACjC,CAAC,CAAC,EAAEP,OAAO,CAAC,EAAEL,kBAAkB,EAChCa,WACAH;gBAEF,OAAOC,WAAWA,WAAW,OAAOH;YACtC;QACF;QACAM,MAAKC,EAAE;YACL,IAAIA,OAAO,wCAAwC;gBACjD,OAAO,CAAC;;;;;AAKhB,CAAC;YACK;YACA,IAAIA,OAAO,8CAA8C;gBACvD,OAAOZ,sBAAsBE;YAC/B;YACA,IAAIU,OAAO,wCAAwC;gBACjD,OAAOb;YACT;QACF;IACF;AACF"}