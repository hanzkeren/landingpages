{"version":3,"sources":["../../../src/lib/vite-plugins/private-dir.ts"],"sourcesContent":["import type { Plugin } from 'vite';\nimport { joinPath } from '../utils/path.js';\n\nexport function privateDirPlugin({\n  privateDir,\n}: {\n  privateDir: string;\n}): Plugin {\n  let privatePath: string;\n  return {\n    name: 'waku:vite-plugins:private-dir',\n    configResolved(viteConfig) {\n      privatePath = joinPath(viteConfig.root, privateDir);\n    },\n    load(id) {\n      if (this.environment.name === 'rsc') {\n        return;\n      }\n      if (id.startsWith(privatePath)) {\n        throw new Error('Load private directory in client side is not allowed');\n      }\n    },\n    hotUpdate(ctx) {\n      if (this.environment.name === 'rsc' && ctx.file.startsWith(privatePath)) {\n        ctx.server.environments.client.hot.send({\n          type: 'custom',\n          event: 'rsc:update',\n          data: {\n            type: 'waku:private',\n            file: ctx.file,\n          },\n        });\n      }\n    },\n  };\n}\n"],"names":["joinPath","privateDirPlugin","privateDir","privatePath","name","configResolved","viteConfig","root","load","id","environment","startsWith","Error","hotUpdate","ctx","file","server","environments","client","hot","send","type","event","data"],"mappings":"AACA,SAASA,QAAQ,QAAQ,mBAAmB;AAE5C,OAAO,SAASC,iBAAiB,EAC/BC,UAAU,EAGX;IACC,IAAIC;IACJ,OAAO;QACLC,MAAM;QACNC,gBAAeC,UAAU;YACvBH,cAAcH,SAASM,WAAWC,IAAI,EAAEL;QAC1C;QACAM,MAAKC,EAAE;YACL,IAAI,IAAI,CAACC,WAAW,CAACN,IAAI,KAAK,OAAO;gBACnC;YACF;YACA,IAAIK,GAAGE,UAAU,CAACR,cAAc;gBAC9B,MAAM,IAAIS,MAAM;YAClB;QACF;QACAC,WAAUC,GAAG;YACX,IAAI,IAAI,CAACJ,WAAW,CAACN,IAAI,KAAK,SAASU,IAAIC,IAAI,CAACJ,UAAU,CAACR,cAAc;gBACvEW,IAAIE,MAAM,CAACC,YAAY,CAACC,MAAM,CAACC,GAAG,CAACC,IAAI,CAAC;oBACtCC,MAAM;oBACNC,OAAO;oBACPC,MAAM;wBACJF,MAAM;wBACNN,MAAMD,IAAIC,IAAI;oBAChB;gBACF;YACF;QACF;IACF;AACF"}