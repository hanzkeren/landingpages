{"version":3,"sources":["../../../src/lib/vite-rsc/plugin.ts"],"sourcesContent":["import react from '@vitejs/plugin-react';\nimport rsc from '@vitejs/plugin-rsc';\nimport type { PluginOption } from 'vite';\nimport type { Config } from '../../config.js';\nimport { allowServerPlugin } from '../vite-plugins/allow-server.js';\nimport { buildMetadataPlugin } from '../vite-plugins/build-metadata.js';\nimport { defaultAdapterPlugin } from '../vite-plugins/default-adapter.js';\nimport { fallbackHtmlPlugin } from '../vite-plugins/fallback-html.js';\nimport { fsRouterTypegenPlugin } from '../vite-plugins/fs-router-typegen.js';\nimport { mainPlugin } from '../vite-plugins/main.js';\nimport { notFoundPlugin } from '../vite-plugins/not-found.js';\nimport { patchRsdwPlugin } from '../vite-plugins/patch-rsdw.js';\nimport { privateDirPlugin } from '../vite-plugins/private-dir.js';\nimport { userEntriesPlugin } from '../vite-plugins/user-entries.js';\nimport { virtualConfigPlugin } from '../vite-plugins/virtual-config.js';\n\nexport function rscPlugin(config: Required<Config>): PluginOption {\n  const extraPlugins = [...(config.vite?.plugins ?? [])];\n  // add react plugin automatically if users didn't include it on their own (e.g. swc, oxc, babel react compiler)\n  if (\n    !extraPlugins\n      .flat()\n      .some((p) => p && 'name' in p && p.name.startsWith('vite:react'))\n  ) {\n    extraPlugins.push(react());\n  }\n\n  return [\n    ...extraPlugins,\n    allowServerPlugin(), // apply `allowServer` DCE before \"use client\" transform\n    rsc({\n      serverHandler: false,\n      keepUseCientProxy: true,\n      useBuildAppHook: true,\n      clientChunks: (meta) => meta.serverChunk,\n    }),\n    mainPlugin(config),\n    userEntriesPlugin(config),\n    virtualConfigPlugin(config),\n    defaultAdapterPlugin(config),\n    notFoundPlugin(),\n    patchRsdwPlugin(),\n    buildMetadataPlugin(config),\n    privateDirPlugin(config),\n    fallbackHtmlPlugin(),\n    fsRouterTypegenPlugin(config),\n  ];\n}\n"],"names":["react","rsc","allowServerPlugin","buildMetadataPlugin","defaultAdapterPlugin","fallbackHtmlPlugin","fsRouterTypegenPlugin","mainPlugin","notFoundPlugin","patchRsdwPlugin","privateDirPlugin","userEntriesPlugin","virtualConfigPlugin","rscPlugin","config","extraPlugins","vite","plugins","flat","some","p","name","startsWith","push","serverHandler","keepUseCientProxy","useBuildAppHook","clientChunks","meta","serverChunk"],"mappings":"AAAA,OAAOA,WAAW,uBAAuB;AACzC,OAAOC,SAAS,qBAAqB;AAGrC,SAASC,iBAAiB,QAAQ,kCAAkC;AACpE,SAASC,mBAAmB,QAAQ,oCAAoC;AACxE,SAASC,oBAAoB,QAAQ,qCAAqC;AAC1E,SAASC,kBAAkB,QAAQ,mCAAmC;AACtE,SAASC,qBAAqB,QAAQ,uCAAuC;AAC7E,SAASC,UAAU,QAAQ,0BAA0B;AACrD,SAASC,cAAc,QAAQ,+BAA+B;AAC9D,SAASC,eAAe,QAAQ,gCAAgC;AAChE,SAASC,gBAAgB,QAAQ,iCAAiC;AAClE,SAASC,iBAAiB,QAAQ,kCAAkC;AACpE,SAASC,mBAAmB,QAAQ,oCAAoC;AAExE,OAAO,SAASC,UAAUC,MAAwB;IAChD,MAAMC,eAAe;WAAKD,OAAOE,IAAI,EAAEC,WAAW,EAAE;KAAE;IACtD,+GAA+G;IAC/G,IACE,CAACF,aACEG,IAAI,GACJC,IAAI,CAAC,CAACC,IAAMA,KAAK,UAAUA,KAAKA,EAAEC,IAAI,CAACC,UAAU,CAAC,gBACrD;QACAP,aAAaQ,IAAI,CAACvB;IACpB;IAEA,OAAO;WACFe;QACHb;QACAD,IAAI;YACFuB,eAAe;YACfC,mBAAmB;YACnBC,iBAAiB;YACjBC,cAAc,CAACC,OAASA,KAAKC,WAAW;QAC1C;QACAtB,WAAWO;QACXH,kBAAkBG;QAClBF,oBAAoBE;QACpBV,qBAAqBU;QACrBN;QACAC;QACAN,oBAAoBW;QACpBJ,iBAAiBI;QACjBT;QACAC,sBAAsBQ;KACvB;AACH"}