{"version":3,"sources":["../../../src/lib/utils/render.ts"],"sourcesContent":["import type {\n  Unstable_ParseRsc,\n  Unstable_RenderHtml,\n  Unstable_RenderRsc,\n} from '../types.js';\n\nexport function createRenderUtils(\n  temporaryReferences: unknown,\n  renderToReadableStream: (data: unknown, options?: object) => ReadableStream,\n  createFromReadableStream: (\n    stream: ReadableStream,\n    options?: object,\n  ) => Promise<unknown>,\n  loadSsrEntryModule: () => Promise<\n    typeof import('../vite-entries/entry.ssr.js')\n  >,\n): {\n  renderRsc: Unstable_RenderRsc;\n  parseRsc: Unstable_ParseRsc;\n  renderHtml: Unstable_RenderHtml;\n} {\n  const onError = (e: unknown) => {\n    console.error('Error during rendering:', e);\n    if (\n      e &&\n      typeof e === 'object' &&\n      'digest' in e &&\n      typeof e.digest === 'string'\n    ) {\n      return e.digest;\n    }\n  };\n\n  return {\n    async renderRsc(elements) {\n      return renderToReadableStream(elements, {\n        temporaryReferences,\n        onError,\n      });\n    },\n    async parseRsc(stream) {\n      return createFromReadableStream(stream, {}) as Promise<\n        Record<string, unknown>\n      >;\n    },\n    async renderHtml(\n      elementsStream,\n      html,\n      options?: { rscPath?: string; actionResult?: any; status?: number },\n    ) {\n      const { INTERNAL_renderHtmlStream: renderHtmlStream } =\n        await loadSsrEntryModule();\n\n      const rscHtmlStream = renderToReadableStream(html, {\n        onError,\n      });\n      const htmlResult = await renderHtmlStream(elementsStream, rscHtmlStream, {\n        formState: options?.actionResult,\n        rscPath: options?.rscPath,\n      });\n      return new Response(htmlResult.stream, {\n        status: htmlResult.status || options?.status || 200,\n        headers: { 'content-type': 'text/html' },\n      });\n    },\n  };\n}\n"],"names":["createRenderUtils","temporaryReferences","renderToReadableStream","createFromReadableStream","loadSsrEntryModule","onError","e","console","error","digest","renderRsc","elements","parseRsc","stream","renderHtml","elementsStream","html","options","INTERNAL_renderHtmlStream","renderHtmlStream","rscHtmlStream","htmlResult","formState","actionResult","rscPath","Response","status","headers"],"mappings":"AAMA,OAAO,SAASA,kBACdC,mBAA4B,EAC5BC,sBAA2E,EAC3EC,wBAGqB,EACrBC,kBAEC;IAMD,MAAMC,UAAU,CAACC;QACfC,QAAQC,KAAK,CAAC,2BAA2BF;QACzC,IACEA,KACA,OAAOA,MAAM,YACb,YAAYA,KACZ,OAAOA,EAAEG,MAAM,KAAK,UACpB;YACA,OAAOH,EAAEG,MAAM;QACjB;IACF;IAEA,OAAO;QACL,MAAMC,WAAUC,QAAQ;YACtB,OAAOT,uBAAuBS,UAAU;gBACtCV;gBACAI;YACF;QACF;QACA,MAAMO,UAASC,MAAM;YACnB,OAAOV,yBAAyBU,QAAQ,CAAC;QAG3C;QACA,MAAMC,YACJC,cAAc,EACdC,IAAI,EACJC,OAAmE;YAEnE,MAAM,EAAEC,2BAA2BC,gBAAgB,EAAE,GACnD,MAAMf;YAER,MAAMgB,gBAAgBlB,uBAAuBc,MAAM;gBACjDX;YACF;YACA,MAAMgB,aAAa,MAAMF,iBAAiBJ,gBAAgBK,eAAe;gBACvEE,WAAWL,SAASM;gBACpBC,SAASP,SAASO;YACpB;YACA,OAAO,IAAIC,SAASJ,WAAWR,MAAM,EAAE;gBACrCa,QAAQL,WAAWK,MAAM,IAAIT,SAASS,UAAU;gBAChDC,SAAS;oBAAE,gBAAgB;gBAAY;YACzC;QACF;IACF;AACF"}