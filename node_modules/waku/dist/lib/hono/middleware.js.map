{"version":3,"sources":["../../../src/lib/hono/middleware.ts"],"sourcesContent":["import type { MiddlewareHandler } from 'hono';\nimport { INTERNAL_runWithContext } from '../context.js';\nimport type { Unstable_ProcessRequest as ProcessRequest } from '../types.js';\n\nexport function contextMiddleware(): MiddlewareHandler {\n  return (c, next) => {\n    const req = c.req.raw;\n    return INTERNAL_runWithContext(req, next);\n  };\n}\n\nexport function rscMiddleware({\n  processRequest,\n}: {\n  processRequest: ProcessRequest;\n}): MiddlewareHandler {\n  return async (c, next) => {\n    const req = c.req.raw;\n    const res = await processRequest(req);\n    if (res) {\n      c.res = res;\n      return;\n    }\n    await next();\n  };\n}\n\nexport function middlewareRunner(\n  middlewareModules: Record<\n    string,\n    () => Promise<{\n      default: () => MiddlewareHandler;\n    }>\n  >,\n): MiddlewareHandler {\n  let handlersPromise: Promise<MiddlewareHandler[]> | undefined;\n  return async (c, next) => {\n    if (!handlersPromise) {\n      handlersPromise = Promise.all(\n        Object.values(middlewareModules).map((m) =>\n          m().then((mod) => mod.default()),\n        ),\n      );\n    }\n    const handlers = await handlersPromise;\n    const run = async (index: number) => {\n      const handler = handlers[index];\n      if (handler) {\n        await handler(c, () => run(index + 1));\n      } else {\n        await next();\n      }\n    };\n    await run(0);\n  };\n}\n"],"names":["INTERNAL_runWithContext","contextMiddleware","c","next","req","raw","rscMiddleware","processRequest","res","middlewareRunner","middlewareModules","handlersPromise","Promise","all","Object","values","map","m","then","mod","default","handlers","run","index","handler"],"mappings":"AACA,SAASA,uBAAuB,QAAQ,gBAAgB;AAGxD,OAAO,SAASC;IACd,OAAO,CAACC,GAAGC;QACT,MAAMC,MAAMF,EAAEE,GAAG,CAACC,GAAG;QACrB,OAAOL,wBAAwBI,KAAKD;IACtC;AACF;AAEA,OAAO,SAASG,cAAc,EAC5BC,cAAc,EAGf;IACC,OAAO,OAAOL,GAAGC;QACf,MAAMC,MAAMF,EAAEE,GAAG,CAACC,GAAG;QACrB,MAAMG,MAAM,MAAMD,eAAeH;QACjC,IAAII,KAAK;YACPN,EAAEM,GAAG,GAAGA;YACR;QACF;QACA,MAAML;IACR;AACF;AAEA,OAAO,SAASM,iBACdC,iBAKC;IAED,IAAIC;IACJ,OAAO,OAAOT,GAAGC;QACf,IAAI,CAACQ,iBAAiB;YACpBA,kBAAkBC,QAAQC,GAAG,CAC3BC,OAAOC,MAAM,CAACL,mBAAmBM,GAAG,CAAC,CAACC,IACpCA,IAAIC,IAAI,CAAC,CAACC,MAAQA,IAAIC,OAAO;QAGnC;QACA,MAAMC,WAAW,MAAMV;QACvB,MAAMW,MAAM,OAAOC;YACjB,MAAMC,UAAUH,QAAQ,CAACE,MAAM;YAC/B,IAAIC,SAAS;gBACX,MAAMA,QAAQtB,GAAG,IAAMoB,IAAIC,QAAQ;YACrC,OAAO;gBACL,MAAMpB;YACR;QACF;QACA,MAAMmB,IAAI;IACZ;AACF"}