{"version":3,"sources":["../../../src/lib/vite-entries/entry.build.ts"],"sourcesContent":["import { createRequire } from 'node:module';\nimport { pathToFileURL } from 'node:url';\nimport serverEntry from 'virtual:vite-rsc-waku/server-entry';\nimport { INTERNAL_setAllEnv } from '../../server.js';\nimport type { Unstable_EmitFile } from '../types.js';\nimport { joinPath } from '../utils/path.js';\n\nfunction resolveModuleId(moduleId: string, rootDir: string) {\n  if (moduleId.startsWith('file://')) {\n    return moduleId;\n  }\n  if (moduleId.startsWith('/')) {\n    // treat as project-root relative (not filesystem root)\n    return pathToFileURL(joinPath(rootDir, moduleId.slice(1))).href;\n  }\n  const require = createRequire(joinPath(rootDir, 'DUMMY.js'));\n  const resolved = require.resolve(moduleId);\n  return pathToFileURL(resolved).href;\n}\n\nexport async function INTERNAL_runBuild({\n  rootDir,\n  emitFile,\n}: {\n  rootDir: string;\n  emitFile: Unstable_EmitFile;\n}) {\n  INTERNAL_setAllEnv(process.env as any);\n  let build = serverEntry.build;\n  for (const enhancer of serverEntry.buildEnhancers || []) {\n    const moduleId = resolveModuleId(enhancer, rootDir);\n    const mod = await import(moduleId);\n    build = await mod.default(build);\n  }\n  await build({ emitFile }, serverEntry.buildOptions || {});\n}\n"],"names":["createRequire","pathToFileURL","serverEntry","INTERNAL_setAllEnv","joinPath","resolveModuleId","moduleId","rootDir","startsWith","slice","href","require","resolved","resolve","INTERNAL_runBuild","emitFile","process","env","build","enhancer","buildEnhancers","mod","default","buildOptions"],"mappings":"AAAA,SAASA,aAAa,QAAQ,cAAc;AAC5C,SAASC,aAAa,QAAQ,WAAW;AACzC,OAAOC,iBAAiB,qCAAqC;AAC7D,SAASC,kBAAkB,QAAQ,kBAAkB;AAErD,SAASC,QAAQ,QAAQ,mBAAmB;AAE5C,SAASC,gBAAgBC,QAAgB,EAAEC,OAAe;IACxD,IAAID,SAASE,UAAU,CAAC,YAAY;QAClC,OAAOF;IACT;IACA,IAAIA,SAASE,UAAU,CAAC,MAAM;QAC5B,uDAAuD;QACvD,OAAOP,cAAcG,SAASG,SAASD,SAASG,KAAK,CAAC,KAAKC,IAAI;IACjE;IACA,MAAMC,UAAUX,cAAcI,SAASG,SAAS;IAChD,MAAMK,WAAWD,QAAQE,OAAO,CAACP;IACjC,OAAOL,cAAcW,UAAUF,IAAI;AACrC;AAEA,OAAO,eAAeI,kBAAkB,EACtCP,OAAO,EACPQ,QAAQ,EAIT;IACCZ,mBAAmBa,QAAQC,GAAG;IAC9B,IAAIC,QAAQhB,YAAYgB,KAAK;IAC7B,KAAK,MAAMC,YAAYjB,YAAYkB,cAAc,IAAI,EAAE,CAAE;QACvD,MAAMd,WAAWD,gBAAgBc,UAAUZ;QAC3C,MAAMc,MAAM,MAAM,MAAM,CAACf;QACzBY,QAAQ,MAAMG,IAAIC,OAAO,CAACJ;IAC5B;IACA,MAAMA,MAAM;QAAEH;IAAS,GAAGb,YAAYqB,YAAY,IAAI,CAAC;AACzD"}