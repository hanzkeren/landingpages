{"version":3,"sources":["../../src/lib/context.ts"],"sourcesContent":["import { AsyncLocalStorage } from 'node:async_hooks';\n\ntype Context = {\n  readonly req: Request;\n  readonly data: Record<string, unknown>;\n};\n\nconst contextStorage = new AsyncLocalStorage<Context>();\n\nexport function INTERNAL_runWithContext<T>(req: Request, next: () => T): T {\n  const context: Context = {\n    req,\n    data: {},\n  };\n  return contextStorage.run(context, next);\n}\n\nexport function getContext() {\n  const context = contextStorage.getStore();\n  if (!context) {\n    throw new Error(\n      'Context is not available. Make sure to use the context middleware.',\n    );\n  }\n  return context;\n}\n\nexport function getContextData(): Record<string, unknown> {\n  const context = contextStorage.getStore();\n  if (!context) {\n    return {};\n  }\n  return context.data;\n}\n"],"names":["AsyncLocalStorage","contextStorage","INTERNAL_runWithContext","req","next","context","data","run","getContext","getStore","Error","getContextData"],"mappings":"AAAA,SAASA,iBAAiB,QAAQ,mBAAmB;AAOrD,MAAMC,iBAAiB,IAAID;AAE3B,OAAO,SAASE,wBAA2BC,GAAY,EAAEC,IAAa;IACpE,MAAMC,UAAmB;QACvBF;QACAG,MAAM,CAAC;IACT;IACA,OAAOL,eAAeM,GAAG,CAACF,SAASD;AACrC;AAEA,OAAO,SAASI;IACd,MAAMH,UAAUJ,eAAeQ,QAAQ;IACvC,IAAI,CAACJ,SAAS;QACZ,MAAM,IAAIK,MACR;IAEJ;IACA,OAAOL;AACT;AAEA,OAAO,SAASM;IACd,MAAMN,UAAUJ,eAAeQ,QAAQ;IACvC,IAAI,CAACJ,SAAS;QACZ,OAAO,CAAC;IACV;IACA,OAAOA,QAAQC,IAAI;AACrB"}